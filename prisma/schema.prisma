generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// GESTÃO DE MEMBROS

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum MemberStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model Application {
  id                String            @id @default(cuid())
  name              String
  email             String            @unique
  company           String
  motivation        String            @db.Text
  status            ApplicationStatus @default(PENDING)
  
  // Token único para completar cadastro após aprovação
  inviteToken       String?           @unique
  inviteTokenExpiry DateTime?
  
  // Auditoria
  submittedAt       DateTime          @default(now())
  reviewedAt        DateTime?
  reviewedBy        String?
  
  // Relacionamento
  member            Member?
  
  @@index([status])
  @@index([email])
}

model Member {
  id              String       @id @default(cuid())
  
  // Relacionamento com Application
  applicationId   String       @unique
  application     Application  @relation(fields: [applicationId], references: [id])
  
  // Dados completos
  name            String
  email           String       @unique
  phone           String?
  company         String
  position        String?
  bio             String?      @db.Text
  expertise       String[]
  
  avatarUrl       String?
  
  status          MemberStatus @default(ACTIVE)
  joinedAt        DateTime     @default(now())
  lastActiveAt    DateTime     @default(now())
  
  // Relacionamentos
  referralsMade      Referral[]   @relation("ReferralGiver")
  referralsReceived  Referral[]   @relation("ReferralReceiver")
  thanksGiven        Thank[]      @relation("ThankGiver")
  thanksReceived     Thank[]      @relation("ThankReceiver")
  
  @@index([email])
  @@index([status])
}

// GERAÇÃO DE NEGÓCIOS

enum ReferralStatus {
  SENT
  IN_NEGOTIATION
  CLOSED
  DECLINED
}

model Referral {
  id                  String         @id @default(cuid())
  
  giverId             String
  giver               Member         @relation("ReferralGiver", fields: [giverId], references: [id], onDelete: Cascade)
  
  receiverId          String
  receiver            Member         @relation("ReferralReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  companyName         String
  contactName         String
  contactInfo         String
  opportunityDesc     String         @db.Text
  estimatedValue      Float?
  
  status              ReferralStatus @default(SENT)
  notes               String?        @db.Text
  
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  closedAt            DateTime?
  
  thank               Thank?
  
  @@index([giverId])
  @@index([receiverId])
  @@index([status])
  @@index([createdAt])
}

model Thank {
  id          String   @id @default(cuid())
  
  referralId  String   @unique
  referral    Referral @relation(fields: [referralId], references: [id], onDelete: Cascade)
  
  giverId     String
  giver       Member   @relation("ThankGiver", fields: [giverId], references: [id], onDelete: Cascade)
  
  receiverId  String
  receiver    Member   @relation("ThankReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  message     String   @db.Text
  isPublic    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  
  @@index([createdAt])
}